import{_ as s}from"./plugin-vue_export-helper-x3n3nnut.js";import{r,o as d,c as i,a as e,b as t,d as a,e as o}from"./app-G7VSIf0C.js";const l="/assets/1710493333257-0001role_interaction_process-y7BN1YBG.png",p="/assets/1710493441810-0002authorization_code_interaction_process-6QhIvT2e.png",c="/assets/1710493521978-0003authorization_code_sequence_diagram-k_urExMe.png",u="/assets/1710493603183-0004implicit_interaction_process-N444x0zj.png",h="/assets/1710493670236-0005ROPC_interaction_process-z_tLbzvn.png",m="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkMAAACKCAIAAAAmI9mZAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAoOSURBVHhe7d3bgusmDEDRM/3/f57qRApVuZkQcKx4r4fU3DHY1jjtdH5+f3//AAAQ1j/2TwAAYiKSAQBiI5IBAGIjkgEAYiOSAQBiI5IBAGIjkgEAYiOSAQBiI5IBAGIjkgEAYiOSAQBim4lkPz8/dgRWAwiFGzaWwf3inQwAEBuRDAAQ2wt/1aX6lqfNKVJaBOBqLvJwoEi9U1Q18/fJZIyJVt+K1QAC4YaNZXC/+HYRABAbkQwAEBsv2gCA2HgnAwDERiQDAMRGJAMAxEYkAwDERiQDAMQ2E8mqv319W6wGEAg3bCyD+8U7GQAgNiIZACA2IhkAIDYiGQAgNiIZACA2IhkAIDYiGQAgNiIZACA2IhkAIDYiGQAgNiIZACA2IhkAIDYiGQAgNiIZACA2IhkAIDYiGQAgtp/f3187BAAgoJl3Mv7oqsdqAIFww8bC34z+ZiO7yx0L4CaIZPFIiBr5TljqEMwA3AGRbL2t8WMwjKnzgxmxEx/E5XdbRLL1PvIydNqIMpBnuc98SxT6pROme5toWDb5ezJLTyfpdLt80DPHOse+W2+i27LJ3zXdNr21PXd6Wz7WEkSyLTbdUdLn+AvZDjqBxHIfypwvdp8zDUe25oLPWcVlsw+RbJcz7ygNMNXhLnJjyzSEJT6ns1DXd+YanjnWcjLztVt8/cvmsV23vjZmfsbXfbXE7fVXY+1atXrT/H6pJd4w0k+1jmTqQWt6epBKNUeSqUhkpV612yppq92WY2lS+JzOWKkrTQrfiUhFvokmq618pvIdlr151Q7FSL6aGCuVao4kW8N9hEymNf9X56ZNfEM9U9+Pz9FjzzfUrjQpfCciFfkmepB13qqQ+FGSspXwDctW1dJsLFWWao4kW8MdkoYj9V/eVDHY9U0croav4Lcz0dJOUdIaS/P7pZZ4GBmr1Orf69SpFvnM7Fg+ff2sebW3Q9rqsKuRsSRTPlvVOsfy2WolsmSmWtrq4bDnam9JtdRnZsfy6ev3O1faKqOt5ooy1TmMTCyjTbKGZT+HFYRkymerWutYaDJlZqXiMMcnO0WqzPGqpa3+5Vg+ff1+55nByny7eCrZktJhUV/aafnUi+bQo++clZ0ou0bl2M9/+ZQmFqqvNcMzzysby1s7kFh+XtKk9E7RDums5dOf77TWbPvLK3yFVieer1N2bkeL9Ce/fLgSkWyvbIM3kVGUpeOweT9Z7jY2zIkDKcs9RXa92QwCXhtvklNedevpAgpLf8j06cjMq231pISlIyOSbSSXyAlhTMgoytLOaXOYo9P2rGAPG2P/gtgwjhWcS3dfWdY9rL3sdQGFpb/Cl10bRLJddoQQ6VC6tcRDNkpZYaszx3rTZxfqI7JTvo+FJ/4Fl011Nb7v2iCSbfF9F4rIbuP3zzHrUGTJQXOtWvq9jYx15nkNjnXY1cRYcvzmBbDDp2bVX8BPLW/WSXUah3M7rCB2TP4lM+OdP8srK1dj9/qk/uVAc9JwWc6OmZSDqpSvfGmnSPjSNG2fFNVBq5lVhx2mpJAcTXbGOuxQZH3K50gr0c9UvkiUYynflR63Gk6MlfJHcs4h4x6OOFJHHZ5XSgrJ0aTvvFW/1aHo5Cjfv2pVyPJVdSA9znr2FfRAtMZSZZORnD6pP1Jz5kk32PVNfGQ1RgZlm4AS90Usg/vFt4shjWwttyuAm+DHEwBAbDPvZPK6Z0dgNYBQuGFjGdwvvl0EAMRGJAMAxHaJSMb7PgBg2kmRTGKVZ7nPfEsU+qUT1vYGAGvpQ0/osWbi0BmRTPbj17HchzIHAO7JPyoJYy+59L8n0x21BAB8Lw1jluD3QV808/tk2Yr3jVSu1kk/klSbl6WaI8lUJLJSr9rtBOl5VVcAdrvsDXs4sfQQKx9rmtNJlm3Fqx1+hMxhZPTrvpPJ7FsnoOemyqXXfOVLRToQmg8AVyAPJXlepUdWRvL1wSVSHU3qcaqgSaHH5aea6PDKLv3tYpWuryUeS5+2QURZdwDI/I0btXgmSf9k0zqWePAVfM2W5R1+XLxIJmSVPcsFgPgkcojsyabPusRyn1rBJvUjn1mdRzf/sdynVoeXFTKSySpnrAAAvoI81nyA0QedZwWzrBfHCmL6QCQr4z8A3BwPxndsj2QS6v0OyfGbwT/rUMxdAVw3AC6l9ah856GnbbOn7qqn6HXMxJVyXQ6lZcoaZsvnSztFwpdqUTlEddBq5jukw1VdAdjtsjesTqzzgEpFQkt9jmidV+uUpzs8U2vymZlNHez6JlgNIBBu2FgG9yvkf/EBAEDCjycAgNhm3snkdc+OwGoAoXDDxjK4X3y7GNLI7nLHArgJIlk8EqJGvhOWOgQzAHdAJNtubTgZDGOKYIY74+K/DyLZXi8FnldJ5xkriCbizHXBM1bWNlgN75N13nfr4WqIZBstv5eyDvVYPhOekmfSNfcHhwar4U2Esbshku1ykXtJ5nDx8KYLRQzGKoSxGyKSbcG9tIQsY2JZT5b7YFlPltttoqygW9RS7m+WYx21u7Li/1ewrGJu6UBpEUqyONx6NzSz61wrXrkanfWpPoO0cqcoqY5lRw/VcQ9bqcNpzBUd0unpp2U9ZDk+OVjUaSJSTqdoRLWyz8wqpGTZsNVKjuWz2kmHtspoqy8u0oOOkTq4jsH9mtlULgWvXI1963M4VnXoffN5n59b61ilnFVFSadoRGfQxOfo8UutRipDjCwLSxfL4H7x7eJ6su6y+pY41weHniYTVpZu6FzNvsj6erLc58ooy3rqFG3SGkjnkFguhkW8/rEEkWyL69xRMg3/oL8gmZ6y9HusL8cKXNHfKPH/3bGCWtEOaSxLP2m+ZwUYJot2wg7iaohku+y4o77sLpVz8Q/r085OBmqN1SlCFOzgDRHJNuKOmlYuXUrOFWX5XqdoTjYNOZYcSzhZtc7k8apyMfHdZr56at2Z93S4GsuXK3VYvVf9WFfeqTT5NMNOjshO5NUin6lGig6ltmWTapHP7FcQml9WqzZESRaqXKJqJi5rcL9mNpVLwfvIaowMyjYBJe6LWAb3i28XQxrZWm5XADfBjycAgNhm3snkdc+OwGoAoXDDxjK4X3y7CACIjUgGAIiNSAYAiI1IBgCIjUgGAIiNSAYAiI1IBgCIjUgGAIiNSAYAiI1IBgCIjUgGAIiNSAYAiI1IBgCIjUgGAIiNSAYAiI1IBgCIjb8ZDQCIjXcyAEBsRDIAQGxEMgBAbEQyAEBsRDIAQGwzkezn58eOwGoAoXDDxjK4X7yTAQBiI5IBAGJ74Tejq2952pwipUUAruYiDweK1DtFVTP/jw8ZY6LVt2I1gEC4YWMZ3C++XQQAxEYkAwDExos2ACA23skAALERyQAAsRHJAACxEckAALERyQAAsRHJAACxEckAALERyQAAsRHJAACxEckAAJH9+fMv0mDgoIwPy3AAAAAASUVORK5CYII=",k={},v=e("h2",{id:"前言",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#前言","aria-hidden":"true"},"#"),t(" 前言")],-1),A={href:"https://tools.ietf.org/html/rfc6749",target:"_blank",rel:"noopener noreferrer"},b=e("p",null,"实际使用中根据服务提供者的 API 文档调用对应 API。",-1),g=e("h2",{id:"简介",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#简介","aria-hidden":"true"},"#"),t(" 简介")],-1),y={href:"https://tools.ietf.org/html/rfc6749",target:"_blank",rel:"noopener noreferrer"},f=e("strong",null,"授权",-1),T=o('<p>第三方应用可以拿着 Token 去调用对应的 API 获取用户的数据。</p><h2 id="名词解释" tabindex="-1"><a class="header-anchor" href="#名词解释" aria-hidden="true">#</a> 名词解释</h2><ul><li><p>Client：客户端</p></li><li><p>Resource Owner：资源所有者</p></li><li><p>Resource Server：资源服务器</p></li><li><p>Authorization Server：认证服务器</p></li><li><p>Token：令牌</p><ul><li>Access Token：授权令牌</li><li>Refresh Token：刷新令牌</li></ul></li></ul><h2 id="角色" tabindex="-1"><a class="header-anchor" href="#角色" aria-hidden="true">#</a> 角色</h2><p>在 OAuth2.0 中有四个角色，分别是：客户端 (Client)、资源所有者 (Resource Owner)、资源服务器 (Resource Server)、认证服务器 (Authorization Server) 。</p><p>这几个角色的交互流程如下图：</p><figure><img src="'+l+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>A =&gt; 客户端 (Client) 请求资源所有者 (Resource Owner) 授予权限</li><li>B =&gt; 资源所有者 (Resource Owner) 授予客户端 (Client) 权限</li><li>C =&gt; 客户端 (Client) 向认证服务器 (Authorization Server) 申请 Token</li><li>D =&gt; 经过认证服务器 (Authorization Server) 判断请求为合法后，颁发 Token 给客户端 (Client)</li><li>E =&gt; 客户端 (Client) 使用 Token 向资源服务器 (Resource Server) 请求资源</li><li>F =&gt; 资源服务器 (Resource Server) 返回资源给客户端 (Client)</li></ul><p>其中在 B 中，授权的方式有四种，分别是：</p><ul><li>Authorization Code</li><li>Implicit</li><li>Resource Owner Password Credentials</li><li>Client Credentials</li></ul><h2 id="endpoints" tabindex="-1"><a class="header-anchor" href="#endpoints" aria-hidden="true">#</a> EndPoints</h2><p>OAuth2.0 有两个重要的 EndPoint，分别是 Authorization endpoint、Token endpoint，一个可选的 Enpoint，是 Redirection endpoint。</p><ul><li><p>Authorization endpoint</p><p>用于向 Resource Owner 获得授权（需要先通过其他方式认证 Resource Owner 的身份）。</p><p>访问这个 Endpoint 时，使用 GET 请求，并在参数中包含 <code>response_type</code> 字段。</p></li><li><p>Redirction endpoint</p><p>用于认证成功后，将客户端重定向到 Redirect_uri 的地址</p></li><li><p>Token endpoint</p><p>用于获取 Token 和刷新 Token。</p><p>访问这个 Endpoint 时，使用 POST 请求，并在参数中包含 <code>grant_type</code> 字段。</p></li></ul><h2 id="授权模式" tabindex="-1"><a class="header-anchor" href="#授权模式" aria-hidden="true">#</a> 授权模式</h2><h3 id="参数说明" tabindex="-1"><a class="header-anchor" href="#参数说明" aria-hidden="true">#</a> 参数说明</h3><ul><li><p><strong>response_type</strong>：授权类型</p><p>认证页面在发送<strong>认证请求</strong>的时候，需要加上的参数，用于指定授权模式</p><ul><li>Authorzation Code：<code>code</code></li><li>Implicit：<code>token</code></li></ul></li><li><p><strong>grant_type</strong>：授权类型</p><p>客户端在发送<strong>获取 Token 请求</strong>的时候，需要加上的参数，用于指定授权模式</p><ul><li><p>Authorzation Code：<code>authorization_code</code></p></li><li><p>Password：<code>password</code></p></li><li><p>Client Credentials：<code>client_credentials</code></p></li></ul></li><li><p><strong>client_id</strong>：客户端 ID</p><p>在认证服务器登记时会提供，用于标记客户端。</p></li><li><p><strong>redirect_uri</strong>：重定向 URL</p><p>用于认证服务器返回时，跳转到的 URL</p><p>默认会重定向到 OAuth 应用程序设置中配置的回调 URL。 可以在请求时带上一个 URL，这个 URL 的主机和端口必须完全匹配回调 URL。</p><p>重定向 URL 的路径必须引用回调 URL 的子目录。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CALLBACK: http://example.com/path

GOOD: http://example.com/path
GOOD: http://example.com/path/subdir/other
BAD:  http://example.com/bar
BAD:  http://example.com/
BAD:  http://example.com:8080/path
BAD:  http://oauth.example.com:8080/path
BAD:  http://example.org
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="authorization-code" tabindex="-1"><a class="header-anchor" href="#authorization-code" aria-hidden="true">#</a> Authorization Code</h3><p>Authorization Code 模式是功能最完整、流程最严密的授权模式。</p><p>这种模式是最常用的模式，适用于有后端的 Web 服务。</p><p>它的特点是用户授权后，会返回一个 Code ，后端通过 Code 获取 Token，这样 Token 就不会经过浏览器，从而保证了 Token 的安全。</p><p>在这种模式中，涉及到三个角色进行交互，分别是客户端 (Client) 、资源所有者 (Resource Owner) 、认证服务器 (Authorization Server) 。</p><figure><img src="`+p+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>A =&gt; 用户访问客户端，选择使用 OAuth 方式登录，客户端会将用户导向认证服务器页面（通常是通过浏览器）</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=xyz&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">server.example.com</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>其中有一些参数：</p><table><thead><tr><th>参数</th><th>说明</th><th>是否必填</th></tr></thead><tbody><tr><td>response_type</td><td>Authorization Code 固定为 “code”</td><td>是</td></tr><tr><td>client_id</td><td>客户端 ID</td><td>是</td></tr><tr><td>redirect_uri</td><td>重定向 URL</td><td>否</td></tr><tr><td>scope</td><td>权限的范围</td><td>否</td></tr><tr><td>state</td><td>可以填任意值，认证服务器会在返回值附上一模一样的参数值，用于防止跨站攻击</td><td>否</td></tr></tbody></table></li><li><p>B =&gt; 用户选择是否授权给客户端</p><p>通常需要用户先登录才允许决定是否授权</p></li><li><p>C =&gt; 认证服务器将用户导向客户端事先指定的重定向 URL (Redirection URL)，同时附上授权码</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">302</span> <span class="token reason-phrase string">Found</span></span>
<span class="token header"><span class="token header-name keyword">Location</span><span class="token punctuation">:</span> <span class="token header-value">https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA&amp;state=xyz</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>其中一些参数：</p><table><thead><tr><th>参数</th><th>备注</th><th>是否必填</th></tr></thead><tbody><tr><td>code</td><td>授权码</td><td>是</td></tr><tr><td>state</td><td>如果客户端发送请求时带有这个参数，认证服务器返回一个一模一样的，用于防止跨站攻击</td><td>否</td></tr></tbody></table><p>注意，授权码有效期一般不超过 10 分钟，只允许使用一次，且与 redicrect_uri 和 client_id 是一一对应的关系。</p></li><li><p>D =&gt; 客户端收到授权码，附上早先的重定向 URL，向认证服务器申请 Token（在后端完成）</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/token</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">server.example.com</span></span>
<span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span>

grant_type=authorization_code&amp;code=SplxlOBeZQQYbYS6WxSbIA&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>备注</th><th>是否必填</th></tr></thead><tbody><tr><td>grant_type</td><td>Authorization Code 固定为 “authorization_code”</td><td>是</td></tr><tr><td>code</td><td>授权码</td><td>是</td></tr><tr><td>redicrect_uri</td><td>重定向 URL（必须与 A 中填的保持一致）</td><td>是</td></tr><tr><td>client_id</td><td>客户端 ID</td><td>是</td></tr></tbody></table></li><li><p>E =&gt; 认证服务器校验授权码和重定向 URL，确认无误后，向客户端发送 Token (Access Token + Refresh Token)</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">200</span> <span class="token reason-phrase string">OK</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json;charset=UTF-8</span></span>
<span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">no-store</span></span>
<span class="token header"><span class="token header-name keyword">Pragma</span><span class="token punctuation">:</span> <span class="token header-value">no-cache</span></span>

{
    &quot;access_token&quot;:&quot;2YotnFZFEjr1zCsicMWpAA&quot;,
    &quot;token_type&quot;:&quot;example&quot;,
    &quot;expires_in&quot;:3600,
    &quot;refresh_token&quot;:&quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;,
    &quot;example_parameter&quot;:&quot;example_value&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>备注</th><th>是否必填</th></tr></thead><tbody><tr><td>access_token</td><td>授权用的 Token</td><td>是</td></tr><tr><td>token_type</td><td>Token 的类型</td><td>是</td></tr><tr><td>expires_in</td><td>Token 过期时间，如果省略，必须通过其他方式设置过期时间</td><td>否</td></tr><tr><td>refresh_token</td><td>更新用的 Token</td><td>否</td></tr></tbody></table><p>通过这个 Token，后端可以通过调用对应的 API 获取资源。</p></li></ul><p>Authorization Code 模式的顺序图如下：</p><figure><img src="`+c+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="implicit" tabindex="-1"><a class="header-anchor" href="#implicit" aria-hidden="true">#</a> Implicit</h3><p>Implicit 模式允许直接向前端颁发 Token，不需要经过通过“授权码”这一步。</p><p>注意，Implicit 模式没有 Refresh Token。</p><p>这种模式适合纯前端应用。</p><figure><img src="'+u+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>A =&gt; 用户访问客户端，使用 OAuth 方式登录，客户端会将用户导向认证服务器页面（通常是通过浏览器）</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/authorize?response_type=token&amp;client_id=s6BhdRkqt3&amp;state=xyz&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">server.example.com</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>备注</th><th>是否必填</th></tr></thead><tbody><tr><td>response_type</td><td>Implicit 固定为 “token”</td><td>是</td></tr><tr><td>client_id</td><td>客户端ID</td><td>是</td></tr><tr><td>redirect_uri</td><td>重定向 URL，需要经过 URL Encode 处理</td><td>否</td></tr><tr><td>scope</td><td>权限的范围</td><td>否</td></tr><tr><td>state</td><td>可以填任意值，认证服务器会在返回值附上一模一样的参数值，用于防止跨站攻击</td><td>否</td></tr></tbody></table></li><li><p>B =&gt; 用户选择是否授权给客户端</p><p>一般需要用户先登录再授权</p></li><li><p>C =&gt; 认证服务器将用户导向客户端指定的 “重定向 URL ”，并在 URL 的 Hash 部分包含了 Token</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">302</span> <span class="token reason-phrase string">Found</span></span>
<span class="token header"><span class="token header-name keyword">Location</span><span class="token punctuation">:</span> <span class="token header-value">http://example.com/cb#access_token=2YotnFZFEjr1zCsicMWpAA&amp;state=xyz&amp;token_type=example&amp;expires_in=3600</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>备注</th><th>是否必填</th></tr></thead><tbody><tr><td>access_token</td><td>授权用的 Token</td><td>是</td></tr><tr><td>token_type</td><td>Token 的类型</td><td>是</td></tr><tr><td>expires_in</td><td>Token 过期时间，如果省略，必须通过其他方式设置过期时间</td><td>否</td></tr><tr><td>scope</td><td>权限范围</td><td>否</td></tr><tr><td>state</td><td>如果客户端发送请求时带有这个参数，认证服务器返回一个一模一样的，用于防止跨站攻击</td><td>否</td></tr></tbody></table><p>注意，Token 的位置是 URL 锚点（fragment），而不是查询字符串（querystring），这是因为 OAuth 2.0 允许跳转网址是 HTTP 协议，因此存在“中间人攻击”的风险，而浏览器跳转时，锚点不会发到服务器，就减少了泄漏令牌的风险</p></li><li><p>D =&gt; 浏览器向 Web 资源服务器发出请求，其中不包括上一步收到的Hash值</p></li><li><p>E =&gt; Web 资源服务器返回一个网页，其中包含的代码可以获取 Hash 值中的 Token</p></li><li><p>F =&gt; 浏览器执行上一步获得的脚本，提取出 Token</p></li><li><p>G =&gt; 浏览器将 Token 发给客户端</p></li></ul><p>注意，Web 资源服务器与上面的资源服务器不是同一个服务器。</p><h3 id="resource-owner-password-credentials" tabindex="-1"><a class="header-anchor" href="#resource-owner-password-credentials" aria-hidden="true">#</a> Resource Owner Password Credentials</h3><p>Resource Owner Password Credentials 模式中，用户向客户端提供自己的用户名和密码。客户端使用这些信息向认证服务器获取 Token。</p><figure><img src="`+h+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>A =&gt; 用户向客户端提供用户名和密码</p></li><li><p>B =&gt; 客户端将用户名和密码发给认证服务器，向后者请求令牌</p><p>这种模式一般直接使用身份验证，比如 HTTP Basic。</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/token</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">server.example.com</span></span>
<span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span>

grant_type=password&amp;username=johndoe&amp;password=A3ddj3w
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>备注</th><th>是否必填</th></tr></thead><tbody><tr><td>grant_type</td><td>Resource Owner Password Credentials 固定为 “password”</td><td>是</td></tr><tr><td>username</td><td>用户名</td><td>是</td></tr><tr><td>password</td><td>密码</td><td>是</td></tr><tr><td>scope</td><td>权限范围</td><td>否</td></tr></tbody></table></li><li><p>C =&gt; 认证服务器确认无误后，向客户端提供访问令牌</p><p>返回的结果如下：</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">200</span> <span class="token reason-phrase string">OK</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json;charset=UTF-8</span></span>
<span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">no-store</span></span>
<span class="token header"><span class="token header-name keyword">Pragma</span><span class="token punctuation">:</span> <span class="token header-value">no-cache</span></span>

{
    &quot;access_token&quot;:&quot;2YotnFZFEjr1zCsicMWpAA&quot;,
    &quot;token_type&quot;:&quot;example&quot;,
    &quot;expires_in&quot;:3600,
    &quot;refresh_token&quot;:&quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;,
    &quot;example_parameter&quot;:&quot;example_value&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="client-credentials" tabindex="-1"><a class="header-anchor" href="#client-credentials" aria-hidden="true">#</a> Client Credentials</h3><p>Client Credentials 模式中，客户端以自己的名义向认证服务器认证。</p><p>这种适用于没有界面的应用程序。</p><figure><img src="`+m+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>A =&gt; 客户端向认证服务器进行身份认证，并要求一个访问令牌</p><p>发送请求如下：</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/token</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">server.example.com</span></span>
<span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span>

grant_type=client_credentials
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>备注</th><th>是否必填</th></tr></thead><tbody><tr><td>grant_type</td><td>Client Credentials 固定为 “client_credentials”</td><td>是</td></tr><tr><td>scope</td><td>权限范围</td><td>否</td></tr></tbody></table><p>这种情况下，认证服务器会通过某种方式验证客户端的身份。</p><p>在 Postman 中，这种模式使用 HTTP Basic ，即在 Header 中加入 Authorization 字段，用户名和密码填 client_id 和 client_secret。</p></li><li><p>B =&gt; 认证服务器确认无误后，向客户端提供访问令牌</p><p>返回结果如下：</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">200</span> <span class="token reason-phrase string">OK</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json;charset=UTF-8</span></span>
<span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">no-store</span></span>
<span class="token header"><span class="token header-name keyword">Pragma</span><span class="token punctuation">:</span> <span class="token header-value">no-cache</span></span>

{
    &quot;access_token&quot;:&quot;2YotnFZFEjr1zCsicMWpAA&quot;,
    &quot;token_type&quot;:&quot;example&quot;,
    &quot;expires_in&quot;:3600,
    &quot;example_parameter&quot;:&quot;example_value&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="使用-token" tabindex="-1"><a class="header-anchor" href="#使用-token" aria-hidden="true">#</a> 使用 Token</h2><p>Token 的类型一般有两种，一种是 bearer，另一种是 mac</p><ul><li><p>bearer</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/resource/1</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com</span></span>
<span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">Bearer mF_9.B5f-4.1JqM</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>mac</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/resource/1</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com</span></span>
<span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">MAC id=&quot;h480djs93hd8&quot;,
	nonce=&quot;274312:dj83hs9s&quot;,
	mac=&quot;kDZvddkndxvhGRXZhvuDjEWhGeE=&quot;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>在访问资源服务器提供的 API 时，带上 Token 就可以正常调用。</p><h2 id="更新-token" tabindex="-1"><a class="header-anchor" href="#更新-token" aria-hidden="true">#</a> 更新 Token</h2><p>如果用户访问时，客户端的 Access Token 已过期，但 Refresh Token 还没过期，可以通过 Refresh Token 更新 Access Token，而不是重新申请。</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code>POST /token HTTP/1.1
Host: server.example.com
Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&amp;refresh_token=tGzv3JOkF0XG5Qx2TlKWIA
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>备注</th><th>是否必填</th></tr></thead><tbody><tr><td>grant_type</td><td>固定为 “refreshtoken”</td><td>是</td></tr><tr><td>refresh_token</td><td>Refresh Token</td><td>是</td></tr><tr><td>scope</td><td>授权范围，不可以超过上一次的申请的范围，默认与上一次一致</td><td>是</td></tr></tbody></table><h2 id="附录" tabindex="-1"><a class="header-anchor" href="#附录" aria-hidden="true">#</a> 附录</h2>`,50),_=e("p",null,"OAuth2.0 标准",-1),x={href:"https://tools.ietf.org/html/rfc6749",target:"_blank",rel:"noopener noreferrer"},q={href:"https://tools.ietf.org/html/rfc6749",target:"_blank",rel:"noopener noreferrer"},w=e("li",null,[e("p",null,"Token (令牌) 与 Password (密码) 的区别"),e("ol",null,[e("li",null,"Token 可以设置权限的范围，比如只允许写或读，而密码是完整权限的。"),e("li",null,"Token 可以设置有效期，到期自动失效，用户无法自己修改；只要用户不修改密码，密码都是长期有效的。"),e("li",null,"即使 Token 还在有效期，数据所有者也可以通过撤消使 Token 立即失效，而密码无法撤销，只能更改。")]),e("p",null,[t("由于 Token 具有访问某些资源的权限，所以 "),e("strong",null,"Token 与密码具有同等的重要性"),t("。")]),e("p",null,"一般来说，Token 的有效期都设置的非常短，但也要避免 Token 的泄露。")],-1),C=e("h2",{id:"参考",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#参考","aria-hidden":"true"},"#"),t(" 参考")],-1),z={href:"https://docs.theidentityhub.com/doc/Protocol-Endpoints/OAuth-2-0/OAuth-2-0-Token-Endpoint.html",target:"_blank",rel:"noopener noreferrer"},R={href:"https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html",target:"_blank",rel:"noopener noreferrer"},I={href:"https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html",target:"_blank",rel:"noopener noreferrer"},O={href:"https://zhuanlan.zhihu.com/p/100625981",target:"_blank",rel:"noopener noreferrer"};function S(F,B){const n=r("ExternalLinkIcon");return d(),i("div",null,[v,e("p",null,[t("本文根据 "),e("strong",null,[e("a",A,[t("RFC 6749"),a(n)])]),t(" 撰写，详细介绍了 OAuth2.0 的认证逻辑。")]),b,g,e("p",null,[t("OAuth2.0 是一个遵循 "),e("a",y,[t("RFC 6749"),a(n)]),t(" 标准的"),f,t("协议，用于向第三方应用颁发 Token。")]),T,e("ul",null,[e("li",null,[_,e("p",null,[e("strong",null,[e("a",x,[t("RFC 6749"),a(n)])]),t(" ："),e("a",q,[t("https://tools.ietf.org/html/rfc6749"),a(n)])])]),w]),C,e("ul",null,[e("li",null,[e("a",z,[t("OAuth 2.0 Token Endpoint | Documentation"),a(n)])]),e("li",null,[e("a",R,[t("理解OAuth 2.0 - 阮一峰的网络日志"),a(n)])]),e("li",null,[e("a",I,[t("OAuth 2.0 的四种方式 - 阮一峰的网络日志"),a(n)])]),e("li",null,[e("a",O,[t("一文带你了解 OAuth2 协议与 Spring Security OAuth2 集成！ - 知乎"),a(n)])])])])}const E=s(k,[["render",S],["__file","00001oauth2.html.vue"]]);export{E as default};
